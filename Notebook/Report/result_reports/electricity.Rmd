---
title: "Electricity Results"
author: "Loong Kuan"
date: "13 January 2017"
---

```{r setup, echo = FALSE, message = FALSE}
library(foreign)
source("../../../core/drift_timeline/timeline.R")
source("../../../core/visualisation.R")
source("../../../core/visualise_results/result_table.R")
source("../../../core/visualise_results/heatmaps.R")
source("../../../core/visualise_results/detailed_likelihood.R")
source("../../../core/visualise_results/detailed_posterior.R")
source("../../../core/verification/compare_distributions.R")
```

In this dataset, 48 instances represents all the data within a day, and therefore, 336 represents a week and 1461 instances roughly represents a month.

```{r electricity, echo = FALSE, message = FALSE, warning = FALSE}
PlotAllWindowSizes("COVARIATE", 1, "../../../../data_out/elecNormNew/moving_chunk/", c())
PlotAllWindowSizes("LIKELIHOOD", 1, "../../../../data_out/elecNormNew/moving_chunk/", c())
PlotAllWindowSizes("POSTERIOR", 1, "../../../../data_out/elecNormNew/moving_chunk/", c())
PlotAllWindowSizes("JOINT", 1, "../../../../data_out/elecNormNew/moving_chunk/", c())
```

One thing to note from the `Posterior` graph (window size 336) above is that at some points 
the drift measured over just single attributes seems to be greater than the drift measured over all attributes.
I'm still trying to figure out the reason for this as this seems to only occur 
when measuring the posterior drift over small window sizes.

Furthermore, there seems to be an event at point `17532` that caused large drifts in the `vicprice`, `vicdemand`, and `transfer` attributes.
Therefore, it will make most sense to analyse the drift between data before and after this point.

```{r detail, echo = FALSE}
results.cov.1 <- ResultTable("../../../../data_out/elecNormNew/analyse/1_22656_22657_45311/1-attributes_covariate.csv")
results.cov.2 <- ResultTable("../../../../data_out/elecNormNew/analyse/1_22656_22657_45311/2-attributes_covariate.csv")
results.joint.1 <- ResultTable("../../../../data_out/elecNormNew/analyse/1_22656_22657_45311/1-attributes_joint.csv")
results.joint.2 <- ResultTable("../../../../data_out/elecNormNew/analyse/1_22656_22657_45311/2-attributes_joint.csv")
results.pos.d.1 <- ResultTable(paste0("../../../../data_out/elecNormNew/analyse/1_22656_22657_45311/1-attributes_posterior_detailed.csv"))
results.pos.1 <- ResultTable(paste0("../../../../data_out/elecNormNew/analyse/1_22656_22657_45311/1-attributes_posterior.csv"))
results.pos.2 <- ResultTable(paste0("../../../../data_out/elecNormNew/analyse/1_22656_22657_45311/2-attributes_posterior.csv"))
results.like.d.1 <- ResultTable(paste0("../../../../data_out/elecNormNew/analyse/1_22656_22657_45311/1-attributes_likelihood_detailed.csv"))
results.like.1 <- ResultTable(paste0("../../../../data_out/elecNormNew/analyse/1_22656_22657_45311/1-attributes_likelihood.csv"))
results.like.2 <- ResultTable(paste0("../../../../data_out/elecNormNew/analyse/1_22656_22657_45311/2-attributes_likelihood.csv"))
```

### Detailed Likelihood (Single Attributes)
```{r}
  VisualPairAttributes(results.like.1, results.like.2, drift.type = "Likelihood", title = "2 Attributes")
  VisualSingleLikelihoodAttribute(results.like.d.1)
```

As expected `vicprice`, `vicdemand`, and `transfer` had the greatest `Likelihood` drift possibly due to their high `Covariate` drift.

The medium `Likelihood` drift of `nswprice` is also expected due to its `Covariate` drift.
However, the `Likelihood` of `nswprice` drift given the 2 classes have a 
possibily significant difference between each other.
This difference probability means that the `Covariate` drift of `nswprice` affected the distribution given the class `DOWN` more that the class `UP`.

### Detailed Posterior (Single Attributes)
```{r}
  VisualPairAttributes(results.pos.1, results.pos.2, drift.type = "Posteriror", title = "2 Attributes")
  VisualSingleAttributeStructure(results.pos.d.1, "Posterior 1 Attribute")
```

From the Detailed Posterior figure, we can observe that most of the posterior drift is from the attributes `transfer` and `vicdemand`.

For the continous attribute `transfer`, the values that drift the most are the extreme low and higher values 
indicating that the class distribution given these values has changed significantly.

Similarly for the continous attribute `vicdemand`, most of the posterior drift occurs on the larger values of the attribute also indicating the change in class distribution give these attribute values.

```{r}
    VisualPairAttributes(results.cov.1, results.cov.2, drift.type = "Covariate", title = "2 Attributes")
    VisualSingleAttribute(results.cov.1, drift.type = "Covariate 1 Attribute")
    VisualPairAttributes(results.joint.1, results.joint.2, drift.type = "Joint", title = "2 Attributes")
    VisualSingleAttribute(results.joint.1, drift.type = "Joint 1 Attribute")
```


### Reason for the spike around instance 17,328
This instance corresponds to the date *2nd of May 1997*. 
During this date, a national electricity market (NEM) was in the process of being established which begin operating on *May 1998*.
However, before then, a trial NEM (NEM1) had been operation since *May 1997* which corresponds to the date of the spike observed.
This trial NEM allowed the wholesale electricity between New South Wales, Victoria, the Australian Capital Territory, and South Australia.
[(source)](http://www.aph.gov.au/About_Parliament/Parliamentary_Departments/Parliamentary_Library/pubs/rp/RP9798/98rp14#Introduction)


### Regular spikes in drift
During the period the data was collected (May 1996 - Dec 1998), the electricity market in NSW and Victoria was slowly being open to competition in stages allowing different types of consumers the ability to choose their retailer of choice.
Therefore quite a few of the sipkes in drift can be explained by the market being opened up to different types of consumers.

Furthermore, the market in NSW started being opened up in October 1996 (before Victoria) therefore explaining the spikes in drift in the electricity price of NSW before NEM1 begin its trial.


### Large price drift around instance 27,759
This instance corresponds to the difference between the da

### 

### Comparing distributions 10,000 instances before and after NEM1 started
```{r, echo = FALSE} 
data.all <- read.arff("../../../../datasets/elecNormNew.arff")
Histogram(data.all[seq(7232,17232),], data.all[seq(17233,27233),])
````

The reason the `transfer` attribute does not spike at `0` before drift is because the dataset used was normalised and therefore the value `0` was normalised to `0.414912`.



### 
